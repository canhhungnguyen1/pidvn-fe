<dx-data-grid
  keyExpr="id"
  [dataSource]="iqcRequests"
  [showColumnLines]="true"
  [showRowLines]="true"
  [showBorders]="true"
  [allowColumnResizing]="true"
  [columnAutoWidth]="true"
  [rowAlternationEnabled]="true"
>
  <dxo-column-chooser
    #columnChooser
    [enabled]="true"
    [mode]="'select'"
    [title]="'Cột hiển thị'"
  >
  </dxo-column-chooser>

  <dxo-toolbar>
    <dxi-item location="before">
      <nz-space>
        <button
          *nzSpaceItem
          nz-button
          nzType="default"
          nz-tooltip
          [nzTooltipTitle]="'Tạo request IQC cho hàng mua ngoài'"
          [nzTooltipColor]="'blue'"
          (click)="openIqcRequestOutSideModal()"
        >
          <span nz-icon nzType="plus"></span>
          IQC REQUEST (OUTSIDE)
        </button>
        <button
          *nzSpaceItem
          nz-button
          nzType="default"
          nz-tooltip
          [nzTooltipTitle]="'Tạo request IQC cho hàng quá 6 tháng'"
          [nzTooltipColor]="'blue'"
        >
          <span nz-icon nzType="plus"></span>
          IQC REQUEST (6 MONTH)
        </button>
        <button
          *nzSpaceItem
          nz-button
          nzType="default"
          nz-tooltip
          [nzTooltipTitle]="'Tạo request IQC cho hàng sorting'"
          [nzTooltipColor]="'blue'"
        >
          <span nz-icon nzType="plus"></span>
          IQC REQUEST (SORTING)
        </button>
      </nz-space>
    </dxi-item>
    <dxi-item location="after">
      <nz-space>
        <nz-range-picker
          [(ngModel)]="searchParams.dateRange"
          nzFormat="yyyy-MM-dd"
          nzMode="date"
          nz-tooltip
          [nzTooltipTitle]="'Ngày tạo request'"
          [nzTooltipColor]="'blue'"
        >
        </nz-range-picker>
        <button nz-button nzType="default">
          <span nz-icon nzType="search"></span>
        </button>
      </nz-space>
    </dxi-item>
    <dxi-item name="exportButton" location="after" />
    <dxi-item name="columnChooserButton" location="after"></dxi-item>
  </dxo-toolbar>

  <dxo-filter-row [visible]="true"></dxo-filter-row>
  <dxo-export [enabled]="true"></dxo-export>

  <dxi-column
    dataField="requestNo"
    caption="Request No"
    [visible]="true"
  ></dxi-column>
  <dxi-column
    dataField="slipNo"
    caption="SlipNo"
    [visible]="true"
  ></dxi-column>
  <dxi-column
    dataField="invoice"
    caption="Invoice"
    [visible]="true"
  ></dxi-column>
  <dxi-column
    dataField="supplier"
    caption="Supplier"
    [visible]="true"
  ></dxi-column>
  <dxi-column
    dataField="statusName"
    caption="Status"
    [visible]="true"
  ></dxi-column>
  <dxi-column
    dataField="requestedByName"
    caption="Người tạo"
    [visible]="true"
  ></dxi-column>
  <dxi-column
    dataField="createdAt"
    caption="Ngày tạo"
    dataType="date"
    format="yyyy-MM-dd"
    [visible]="true"
  ></dxi-column>
  <dxi-column
    dataField="type"
    caption="Type"
    [visible]="true"
  ></dxi-column>

  <dxi-column
    dataField="remark"
    caption="Ghi chú"
    [visible]="true"
  ></dxi-column>

  <dxi-column
    caption="Action"
    cellTemplate="actionTemplate"
    [fixed]="true"
    fixedPosition="right"
  ></dxi-column>
  <div *dxTemplate="let item of 'actionTemplate'" style="text-align: center">
    <a>Chi tiết</a>
  </div>

  <dxo-paging [pageSize]="20"></dxo-paging>
  <dxo-pager
    [showPageSizeSelector]="true"
    [allowedPageSizes]="[10, 25, 50, 100]"
  >
  </dxo-pager>
</dx-data-grid>

<nz-modal
  [(nzVisible)]="isOpenIqcRequestOutSideModal"
  nzTitle="Tạo request IQC (OUTSIDE)"
>
  <ng-container *nzModalContent>
    <nz-table
      nzBordered
      [nzData]="['']"
      [nzFrontPagination]="false"
      nzSize="small"
    >
      <tbody>
        <tr>
          <td style="font-weight: bold">
            Slip No <span style="color: red">*</span>
          </td>
          <td>
            <input nz-input [(ngModel)]="iqcRequest.slipNo" readonly />
          </td>
        </tr>
        <tr>
          <td style="font-weight: bold">
            Invoice <span style="color: red">*</span>
          </td>
          <td>
            <nz-select
              nzShowSearch
              nzAllowClear
              nzPlaceHolder="Mã Invoice"
              [(ngModel)]="iqcRequest.invoice"
              (ngModelChange)="onSelectInvoice($event)"
              style="width: 100%"
            >
              <nz-option
                *ngFor="let item of purWhRecordDtos"
                [nzValue]="item.invoice"
                [nzLabel]="item.invoice"
              >
              </nz-option>
            </nz-select>
          </td>
        </tr>
        <tr>
          <td style="font-weight: bold">
            Supplier <span style="color: red">*</span>
          </td>
          <td>
            <input
              nz-input
              placeholder="Nhà cung cấp"
              [(ngModel)]="iqcRequest.supplier"
            />
          </td>
        </tr>
        <tr>
          <td style="font-weight: bold">Ghi chú</td>
          <td>
            <input
              nz-input
              placeholder="Ghi chú"
              [(ngModel)]="iqcRequest.remark"
            />
          </td>
        </tr>
      </tbody>
    </nz-table>
  </ng-container>
  <ng-template [nzModalFooter]>
    <button nz-button nzType="default" (click)="isOpenIqcRequestOutSideModal = false">Close</button>
    <button nz-button nzType="primary" (click)="createIqcRequestOutSide()">Tạo request</button>
  </ng-template>
</nz-modal>
